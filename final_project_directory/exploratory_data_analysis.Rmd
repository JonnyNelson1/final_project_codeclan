---
title: "exploratory_data_analysis"
author: "Jonny Nelson"
date: "07/02/2022"
output: html_document
---

# LendingClub: Predicting Loan Defaults
* who is likely to default?
* who to lend to in the future?

```{r}
library(janitor)
library(tidyverse)

loans_dictionary <- read_csv("defaults_data/LCDataDictionary.csv")
loans <- read_csv("defaults_data/lending_club_loans.csv")
knitr::kable(loans_dictionary)
```

<br>

::: {.emphasis}
## Noteable points
* acc_open_past_24mths - What are number of trades? - All NA values?
* addrs_state - Mutate on the state name for geospatial mapping
* annual_inc_joint & application_type - can be selected out as all registrations provided are application_type == INDIVIDUAL - 3 NA's for application type.
* avg_cur_bal, bc_open_to_buy, bc_util - All NA's
* chargeoff_within_12_mths - only 148 NA's - otherwise == 0
* collection_recovery_fee - LendingClub expense
* collections_12_mths_ex_med - No of collections
* delinq_2yrs - 30+ past due incidence rate
* delinq_amnt - loads of NA's and 0's
* desc - only avaliable for 1/4 of observations - text analysis???
* dti - debt obligations/monthly income
* dti_joint - NA's as expected
* earliest_cr_line - credint line opening month
* emp_length - employment length time
* emp_title - Employer Title replaces Employer Name for all loans listed after 9/23/2013 - investigate further
* fico_range -> get mean?
* funded_amnt - $ commited to that loan at that point in time
* funded_amnt_inv - $ funded by investors? comming from peer-to-peers lending?
* grade - need to figure out different grades of loans
* home_ownership - rent, own, mortgage or other
* id - unique for loan
* il_util - ratio of total current balance to credit limit on all accounts? Look into this one further
* initial_list_status - W and F? 
* inq_last_6mths - no of inquiries in previous 6 months
* inq_fi and inq_last_12m - All NA's
* installment - monthly's
* int_rate - interest rate
* issue_d - issue date
* last_credit_pull_d - most recent pulled credit for loan
* last_fico's - last pulled fico's - what is the last pulled?
* loan_amnt 
* loan_status - find out difference between observations . . .
* max_bal_bc - All NA's
* member_id - unique id for the member - all values are distinct
* mo_sin . . . - all NA's
* mort_acc - all NA's 
:::

```{r}
knitr::kable(loans_dictionary)
```


```{r}
loans %>%
  select(mort_acc) 

sum(is.na(loans$mort_acc))

range(loans$funded_amnt)

unique(loans$loan_status)

n_distinct(loans$member_id)

summary(loans)

# Summary of loans gives all the variables that have NA's so just going to plug these in and remove them straight away to remove hassle

# Should be left with 59 variables to sort through and understand
```

```{r}
# A function to get rid of all variables with a proportion of NA's greater than 95% and assigned to a new object.

loans_cols_na_removed <- loans[lapply(loans, function(x) sum(is.na(x)) / length(x) ) < 0.95]
loans_cols_na_removed
```

* pymnt_plant - indicates if a payment plan is inplace - yes or no - as factor
* remove url 
* desc - remove the "Borrower added on 12/16/11 > " bit and then do text analysis 
* visualise by purpose
* title - loads of vars - text analysis
* zip_code and addr_state can make a geospatial mapping
* mths_since_last_record - ???
* open_acc - number of open lines of credit in the borrower's credit file
* pub_rec - number of derogatory public records ???
* revol_bal - Total credit revolving balance
* revol_util - Amount of credit the borrower is using relative to all available revolving credit. ???
* total_acc - total lines of credit lines
* initial_list_status - initial listing status of the loan???
* out_prncp(-inv) - remaining outstanding principal for total amount funded (investors)
* total_pymnt(-inv) - Payments received to date for total amount funded (by investors)
* total_rec_prncp - Principal recieved to date
* total_rec_int - Interest recieved to date
* total_rec_late_fee - Late fees recieved to date
* recoveries - post charge off gross recovery ??? 
* collection_recovery_fee - post-charge off collection fee for recovery.
* last_pymnt_d, next_pymnt_d & last_pymnt-amnt - all linked 
* last_credit_pull_d - last month a payment was recieved 
* last_fico_ranges - ???
* collections_12_mths_ex_med - number of collections
* policy_code - publicly available policy_code == 1???
* application_type - All individual
* acc_now_delinq - 1 is yes
* charge_within_12_mths - Number of charge-offs
* delinq_amnt - past due amount for which borrower is not able to pay
* pub_rec_bankruptcies - public recorded bankrupty 
* tax_lien - a legal claim against that persons assets - (yes/no)

```{r}
unique(loans$tax_liens)

# sum(loans$application_type == 'INDIVIDUAL', na.rm = TRUE)

knitr::kable(loans_dictionary)
```

